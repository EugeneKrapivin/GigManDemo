name: deploy dev to stg

on:
  workflow_dispatch:
  push:
    branches: [ "dev" ]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Download gigman
      run: wget https://github.com/EugeneKrapivin/gigman.cli/files/10148596/gigman.zip -O gigman.zip
    - name: Extract gigman
      run: 7z x gigman.zip
    - name: Make gigman executable
      run: chmod +x gigman
    - name: create gigman context
      run: ./gigman context create --userkey ${{secrets.GIGMAN_USERKEY}} --secret ${{secrets.GIGMAN_SECRET}} --name gha
    - name: set gigman context
      run: ./gigman context set -n gha
    - name: Apply gigman
      run: ./gigman site apply -e dev -t blablabla
